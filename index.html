<!DOCTYPE html>
<html lang="pt-BR">
    <link rel="stylesheet" href="./css/style.css">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Overbooking</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
</head>
<body>

  <div class="header">
    <img src="./assets/logo_UNB.png" alt="logo UNB" class="logo">
    <h1> 
      SISTEMAS DE INFORMAÇÃO EM ENGENHARIA DE PRODUÇÃO
      <br>
      Sistema de Análise de Overbooking
    </h1>
    <p>Tiago Alves dos Santos Neto - 202014762</p>
  </div>

  <div class="info-box">
    <h3>Informações do Sistema</h3>
    <p>Este sistema calcula em tempo real a probabilidade de overbooking conforme você ajusta os parâmetros. Os resultados são atualizados instantaneamente, incluindo o gráfico dinâmico.</p>
  </div>

  <h2 class="section-title">Configuração dos Parâmetros</h2>

  <!-- Capacidade da Aeronave -->
  <div class="slider-container">
    <label for="capacidade">Capacidade da Aeronave:</label>
    <input type="range" id="capacidade" min="50" max="400" step="1" value="120" oninput="atualizarCalculo()">
    <div class="value-display">Valor: <span id="capacidade-valor">120</span> assentos</div>
  </div>

  <!-- Probabilidade de Comparecimento -->
  <div class="slider-container">
    <label for="probabilidade">Probabilidade de Comparecimento (%):</label>
    <input type="range" id="probabilidade" min="50" max="100" step="1" value="88" oninput="atualizarCalculo()">
    <div class="value-display">Valor: <span id="probabilidade-valor">88</span>%</div>
  </div>

  <!-- Passagens à Venda -->
  <div class="slider-container">
    <label for="passagens">Passagens à Venda:</label>
    <input type="range" id="passagens" min="50" max="500" step="1" value="130" oninput="atualizarCalculo()">
    <div class="value-display">Valor: <span id="passagens-valor">130</span> passagens</div>
  </div>

  <div class="results">
    <h2 class="section-title">Resultados da Simulação</h2>
    
    <div class="result-item">
      <span class="result-title">Probabilidade de Overbooking:</span>
      <span class="result-value" id="prob-overbooking">70.72%</span>
      <div class="risk-meter">
        <div class="risk-level risk-high" id="risk-visual" style="width: 70.72%"></div>
      </div>
      <div class="risk-labels">
        <span>0%</span>
        <span>Limite: 7%</span>
        <span>100%</span>
      </div>
    </div>
    
    <div class="result-item">
      <span class="result-title">Máximo de Passagens com Risco ≤ 7%:</span>
      <span class="result-value" id="max-passagens">125 passagens (6.55% de risco)</span>
    </div>
    
    <div class="result-item">
      <span class="result-title">Passageiros Esperados:</span>
      <span id="passageiros-esperados">114.40 passageiros</span>
    </div>
    
    <div class="result-item">
      <span class="result-title">Passageiros Barrados (esperado):</span>
      <span id="passageiros-barrados">5.32 passageiros</span>
    </div>
    
    <div class="result-item">
      <span class="result-title">Passageiros Embarcados (efetivo):</span>
      <span id="passageiros-embarcados">109.08 passageiros</span>
    </div>
    
    <div class="result-item">
      <span class="result-title">Assentos Vazios (esperado):</span>
      <span id="assentos-vazios">10.92 assentos</span>
    </div>
    
    <!-- Gráfico Dinâmico de Probabilidade de Overbooking -->
    <h2 class="section-title">Gráfico de Probabilidade de Overbooking</h2>
    <div class="chart-container">
      <canvas id="overbookingChart"></canvas>
    </div>
    
    <h2 class="section-title">Análise de Viabilidade</h2>
    
    <div class="recommendation">
      <h3>Recomendação para Venda de <span id="current-passagens">130</span> Passagens</h3>
      <p id="viability-analysis">Não é viável vender 130 passagens. O risco de overbooking é de 70.72%, que está significativamente acima do limite de 7% estabelecido pela empresa. Recomenda-se vender no máximo 125 passagens.</p>
    </div>
  </div>

  <div class="header">
    <h1>Análise de ROI do Sistema de Informação</h1>
  </div>

  <div class="info-box">
    <h3>Contextualização</h3>
    <p>Após analisar possíveis lucros oriundos do overbooking, a empresa decide investir em um Sistema de Informação mais sofisticado para otimizar a venda de passagens.</p>
  </div>

  <div class="results">
    <h2 class="section-title">Cálculo do ROI Esperado</h2>
    <p>Com base nos dados fornecidos, calculamos o ROI (Return on Investment) esperado para o novo sistema de informação.</p>
    
    <div class="roi-details">
      <div class="roi-detail-item">
        <h4>Investimento Inicial</h4>
        <div class="roi-detail-value">R$ 50.000,00</div>
        <p>Custo para aquisição e implementação</p>
      </div>
      
      <div class="roi-detail-item">
        <h4>Receita Adicional Esperada</h4>
        <div class="roi-detail-value">R$ 80.000,00</div>
        <p>Aumento projetado na receita anual</p>
      </div>
      
      <div class="roi-detail-item">
        <h4>Custo Operacional Anual</h4>
        <div class="roi-detail-value">R$ 10.000,00</div>
        <p>Manutenção e suporte contínuos</p>
      </div>
      
      <div class="roi-detail-item">
        <h4>ROI Esperado</h4>
        <div class="roi-detail-value">140%</div>
        <p>Retorno sobre o investimento</p>
      </div>
    </div>
    
    <div class="result-item">
      <span class="result-title">Fórmula de Cálculo:</span>
      <p>ROI = [(Receita Adicional - Custos Operacionais) / Investimento Inicial] × 100%</p>
      <p>ROI = [(80.000 - 10.000) / 50.000] × 100% = 140%</p>
    </div>
  </div>

  <div class="results">
    <h2 class="section-title">Análise de Cenários com Simulação Binomial</h2>
    <p>Considerando a incerteza no desempenho do sistema, simulamos diferentes cenários baseados em distribuição binomial.</p>
    
    <div class="scenario-container">
      <div class="scenario scenario-optimistic">
        <h4>Cenário Otimista</h4>
        <p>Receita adicional: <span class="result-value">R$ 85.000,00</span></p>
        <p>Probabilidade: <span class="result-value">25%</span></p>
        <p>ROI: <span class="result-value">150%</span></p>
      </div>
      
      <div class="scenario scenario-realistic">
        <h4>Cenário Realista</h4>
        <p>Receita adicional: <span class="result-value">R$ 80.000,00</span></p>
        <p>Probabilidade: <span class="result-value">50%</span></p>
        <p>ROI: <span class="result-value">140%</span></p>
      </div>
      
      <div class="scenario scenario-pessimistic">
        <h4>Cenário Pessimista</h4>
        <p>Receita adicional: <span class="result-value">R$ 60.000,00</span></p>
        <p>Probabilidade: <span class="result-value">25%</span></p>
        <p>ROI: <span class="result-value">0%</span></p>
      </div>
    </div>
    
    <div class="chart-container">
      <canvas id="revenueChart"></canvas>
    </div>
    
    <h3 class="section-title">Probabilidade de Receita por Faixa</h3>
    <table>
      <tr>
        <th>Faixa de Receita</th>
        <th>Probabilidade</th>
        <th>ROI Correspondente</th>
      </tr>
      <tr>
        <td>Acima de R$ 75.000,00</td>
        <td>60%</td>
        <td>130% a 180%</td>
      </tr>
      <tr>
        <td>Entre R$ 60.000,00 e R$ 75.000,00</td>
        <td>30%</td>
        <td>0% a 130%</td>
      </tr>
      <tr>
        <td>Abaixo de R$ 60.000,00</td>
        <td>10%</td>
        <td>Negativo</td>
      </tr>
    </table>
    
    <div class="result-item">
      <span class="result-title">Impacto da Incerteza no ROI</span>
      <p>A incerteza no desempenho do sistema pode afetar significativamente o ROI final:</p>
      <ul>
        <li>No <strong>cenário otimista</strong>, o ROI pode chegar a 150% ou mais</li>
        <li>No <strong>cenário realista</strong>, o ROI se mantém em torno de 140%</li>
        <li>No <strong>cenário pessimista</strong>, o ROI pode cair para 0% ou mesmo negativo se a receita for muito baixa</li>
      </ul>
    </div>
  </div>

  <div class="results">
    <h2 class="section-title">Decisão e Recomendações</h2>
    
    <div class="recommendation">
      <h3>Recomendação Final</h3>
      <p>Com base na análise realizada, <span class="result-value">recomendamos a adoção imediata</span> do sistema de informação, uma vez que o ROI esperado de 140% representa a retorno atrativo sobre o investimento, mesmo considerando os cenários de incerteza.</p>
    </div>
    
    <div class="result-item">
      <span class="result-title">Justificativa Técnica e Financeira</span>
      <p>O sistema apresenta uma relação custo-benefício favorável, com alta probabilidade (60%) de gerar retornos superiores a 130%. Mesmo no cenário pessimista, as perdas são limitadas ao investimento inicial, enquanto os cenários realista e otimista oferecem retornos significativos.</p>
    </div>
    
    <div class="result-item">
      <span class="result-title">Sugestões de Melhoria</span>
      <ul>
        <li>Implementar o sistema gradualmente para mitigar riscos</li>
        <li>Estabelecer métricas de acompanhamento contínuo do desempenho</li>
        <li>Desenvolver um plano de contingência para o cenário pessimista</li>
        <li>Negociar contratos de suporte com base no desempenho real do sistema</li>
        <li>Considerar um período de teste antes da implementação completa</li>
      </ul>
    </div>
    
    <div class="conclusion">
      <h3>Conclusão</h3>
      <p>O investimento em um sistema de informação mais sofisticado é financeiramente viável e estrategicamente alinhado com os objetivos de crescimento. A análise demonstra que os benefícios superam os riscos, com alto potencial de retorno positivo.</p>
    </div>
  </div>

  <script>
    // Variável global para o gráfico
    let overbookingChart = null;
    let revenueChart = null;

    // Função para calcular combinações (n choose k)
    function combinacao(n, k) {
      if (k < 0 || k > n) return 0;
      if (k === 0 || k === n) return 1;
      
      k = Math.min(k, n - k);
      let result = 1;
      for (let i = 0; i < k; i++) {
        result = result * (n - i) / (i + 1);
      }
      return result;
    }
    
    // Função para calcular probabilidade de overbooking
    function calcularOverbooking(n_passagens, capacidade, p_show) {
      let prob = 0;
      for (let k = capacidade + 1; k <= n_passagens; k++) {
        prob += combinacao(n_passagens, k) * Math.pow(p_show, k) * Math.pow(1 - p_show, n_passagens - k);
      }
      return prob;
    }
    
    // Função para encontrar máximo de passagens com risco <= 7%
    function encontrarMaximoPassagens(capacidade, p_show) {
      let max_passagens = capacidade;
      let prob = 0;
      
      for (let n = capacidade + 1; n <= 200; n++) {
        prob = calcularOverbooking(n, capacidade, p_show);
        if (prob <= 0.07) {
          max_passagens = n;
        } else {
          break;
        }
      }
      
      return {
        max_passagens: max_passagens,
        probabilidade: calcularOverbooking(max_passagens, capacidade, p_show)
      };
    }

    // Função para calcular estatísticas de passageiros
    function calcularEstatisticas(n_passagens, capacidade, p_show) {
      // Cálculo simplificado usando aproximação normal
      const media = n_passagens * p_show;
      const variancia = n_passagens * p_show * (1 - p_show);
      const desvio_padrao = Math.sqrt(variancia);
      
      // Passageiros barrados (aproximação)
      let esperado_barrados = 0;
      if (media > capacidade) {
        const z = (media - capacidade) / desvio_padrao;
        esperado_barrados = desvio_padrao * (Math.exp(-z*z/2) / Math.sqrt(2*Math.PI) + z * (1 - normalCDF(-z)));
      }
      
      const E_embarcados = Math.min(media, capacidade) - esperado_barrados;
      const assentos_vazios = Math.max(0, capacidade - E_embarcados);
      
      return {
        passageiros_esperados: media,
        passageiros_barrados_esperados: esperado_barrados,
        passageiros_embarcados_efetivos: E_embarcados,
        assentos_vazios_esperados: assentos_vazios
      };
    }

    // Função de distribuição acumulada normal
    function normalCDF(x) {
      // Aproximação da função erro
      const t = 1 / (1 + 0.2316419 * Math.abs(x));
      const d = 0.3989423 * Math.exp(-x * x / 2);
      let prob = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
      
      if (x > 0) {
        prob = 1 - prob;
      }
      
      return prob;
    }

    // Função para gerar dados do gráfico de overbooking
    function gerarDadosGraficoOverbooking(capacidade, probabilidade) {
      const n_min = Math.max(capacidade - 20, 50);
      const n_max = capacidade + 50;
      const passagensArray = [];
      const probabilidadesArray = [];
      
      for (let n = n_min; n <= n_max; n++) {
        const prob = calcularOverbooking(n, capacidade, probabilidade);
        passagensArray.push(n);
        probabilidadesArray.push(prob * 100); // Convertendo para porcentagem
      }
      
      return {
        passagens: passagensArray,
        probabilidades: probabilidadesArray
      };
    }

    // Função para criar ou atualizar o gráfico de overbooking
    function atualizarGraficoOverbooking(capacidade, probabilidade, n_passagens_atual) {
      const ctx = document.getElementById('overbookingChart').getContext('2d');
      const dados = gerarDadosGraficoOverbooking(capacidade, probabilidade);
      
      // Destruir gráfico existente se houver
      if (overbookingChart) {
        overbookingChart.destroy();
      }
      
      // Criar novo gráfico
      overbookingChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: dados.passagens,
          datasets: [
            {
              label: 'Probabilidade de Overbooking (%)',
              data: dados.probabilidades,
              borderColor: '#1a237e',
              backgroundColor: 'rgba(26, 35, 126, 0.1)',
              borderWidth: 2,
              fill: true,
              tension: 0.4
            },
            {
              label: 'Limite de Risco (7%)',
              data: Array(dados.passagens.length).fill(7),
              borderColor: '#f44336',
              borderWidth: 1,
              borderDash: [5, 5],
              fill: false,
              pointRadius: 0
            },
            {
              label: 'Passagens Vendidas Atuais',
              data: dados.probabilidades.map((_, index) => 
                dados.passagens[index] === n_passagens_atual ? dados.probabilidades[index] : null
              ),
              backgroundColor: '#ff9800',
              borderColor: '#ff9800',
              pointRadius: 6,
              pointHoverRadius: 8,
              showLine: false
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'Probabilidade de Overbooking vs. Número de Passagens Vendidas',
              font: {
                size: 16
              }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed.y !== null) {
                    label += context.parsed.y.toFixed(2) + '%';
                  }
                  return label;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Probabilidade de Overbooking (%)'
              },
              max: 100
            },
            x: {
              title: {
                display: true,
                text: 'Passagens Vendidas'
              }
            }
          }
        }
      });
    }

    // Função para criar o gráfico de receita (estático)
    function criarGraficoReceita() {
      const ctx = document.getElementById('revenueChart').getContext('2d');
      
      // Dados para o gráfico de distribuição de probabilidade
      const revenueData = {
        labels: ['50-60k', '60-70k', '70-75k', '75-80k', '80-85k', '85k+'],
        datasets: [{
          label: 'Probabilidade de Receita',
          data: [5, 25, 30, 25, 10, 5],
          backgroundColor: [
            '#e74c3c', '#f39c12', '#f1c40f', '#2ecc71', '#27ae60', '#16a085'
          ],
          borderWidth: 1
        }]
      };

      // Configuração do gráfico
      const config = {
        type: 'bar',
        data: revenueData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'Distribuição de Probabilidade da Receita Adicional',
              font: {
                size: 16
              }
            },
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `Probabilidade: ${context.raw}%`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Probabilidade (%)'
              },
              max: 35
            },
            x: {
              title: {
                display: true,
                text: 'Faixa de Receita (R$)'
              }
            }
          }
        }
      };
      
      revenueChart = new Chart(ctx, config);
    }

    // Função para atualizar todos os cálculos
    function atualizarCalculo() {
      // Obter valores atuais dos sliders
      const capacidade = parseInt(document.getElementById('capacidade').value);
      const probabilidade = parseInt(document.getElementById('probabilidade').value) / 100;
      const n_passagens = parseInt(document.getElementById('passagens').value);
      
      // Atualizar valores exibidos
      document.getElementById('capacidade-valor').textContent = capacidade;
      document.getElementById('probabilidade-valor').textContent = Math.round(probabilidade * 100);
      document.getElementById('passagens-valor').textContent = n_passagens;
      document.getElementById('current-passagens').textContent = n_passagens;
      
      // Calcular probabilidade de overbooking
      const probOverbooking = calcularOverbooking(n_passagens, capacidade, probabilidade);
      document.getElementById('prob-overbooking').textContent = (probOverbooking * 100).toFixed(2) + '%';
      
      // Atualizar medidor de risco visual
      const riskVisual = document.getElementById('risk-visual');
      riskVisual.style.width = (probOverbooking * 100) + '%';
      
      // Atualizar classe de risco
      riskVisual.className = 'risk-level';
      if (probOverbooking <= 0.07) {
        riskVisual.classList.add('risk-low');
      } else if (probOverbooking <= 0.15) {
        riskVisual.classList.add('risk-medium');
      } else {
        riskVisual.classList.add('risk-high');
      }
      
      // Encontrar máximo de passagens com risco <= 7%
      const maxInfo = encontrarMaximoPassagens(capacidade, probabilidade);
      document.getElementById('max-passagens').textContent = 
        `${maxInfo.max_passagens} passagens (${(maxInfo.probabilidade * 100).toFixed(2)}% de risco)`;
        
      // Calcular estatísticas
      const stats = calcularEstatisticas(n_passagens, capacidade, probabilidade);
      document.getElementById('passageiros-esperados').textContent = 
        `${stats.passageiros_esperados.toFixed(2)} passageiros`;
      document.getElementById('passageiros-barrados').textContent = 
      `${stats.passageiros_barrados_esperados.toFixed(2)} passageiros`;
      document.getElementById('passageiros-embarcados').textContent = 
      `${stats.passageiros_embarcados_efetivos.toFixed(2)} passageiros`;
      document.getElementById('assentos-vazios').textContent = 
      `${stats.assentos_vazios_esperados.toFixed(2)} assentos`;
      
      // Atualizar análise de viabilidade
      let analysisText = "";
      if (probOverbooking > 0.07) {
        analysisText = `Não é viável vender ${n_passagens} passagens. `;
        analysisText += `O risco de overbooking é de ${(probOverbooking * 100).toFixed(2)}%, `;
        analysisText += `que está significativamente acima do limite de 7% estabelecido pela empresa. `;
        analysisText += `Recomenda-se vender no máximo ${maxInfo.max_passagens} passagens.`;
      } else {
        analysisText = `É viável vender ${n_passagens} passagens. `;
        analysisText += `O risco de overbooking é de ${(probOverbooking * 100).toFixed(2)}%, `;
        analysisText += `que está dentro do limite de 7% estabelecido pela empresa.`;
      }
      
      document.getElementById('viability-analysis').textContent = analysisText;
      
      // Atualizar o gráfico de overbooking
      atualizarGraficoOverbooking(capacidade, probabilidade, n_passagens);
    }

    // Inicializar valores exibidos
    document.getElementById('capacidade-valor').innerText = document.getElementById('capacidade').value;
    document.getElementById('probabilidade-valor').innerText = document.getElementById('probabilidade').value;
    document.getElementById('passagens-valor').innerText = document.getElementById('passagens').value;
    
    // Calcular inicialmente
    atualizarCalculo();
    
    // Criar gráfico de receita
    criarGraficoReceita();
  </script>

</body>
</html>